version: "3.3"

services:
  api:
    image: php:7.2-fpm
    volumes:
      - ${API_PATH}/supervisor.conf:/etc/supervisor/conf.d/api.conf
      - ${API_PATH}:/var/www/laravel
    environment:
      - VIRTUAL_HOST=${API_HOST}
      - VIRTUAL_PROTO=fastcgi
      - VIRTUAL_ROOT=/var/www/laravel/public/index.php
      - APP_MAIN_DB=${APP_MAIN_DB}
      - APP_IMPORT_DB=${APP_IMPORT_DB}
  app:
    image: nginx:1.15.3
    volumes:
      - ${APP_PATH}:/usr/share/nginx/html
    environment:
      - VIRTUAL_HOST=${APP_HOST}

# when telnet other service, you may need to configure firewalld
# docker network create --driver=bridge --subnet=10.50.0.0/16 baffedu
networks:
  default:
    external:
      name: baffedu